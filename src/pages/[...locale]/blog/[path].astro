---
import { SITE, BLOG } from "~/config.mjs";

import Layout from "~/layouts/PageLayout.astro";
import SinglePost from "~/components/blog/SinglePost.astro";

import { getCanonical } from "~/utils/permalinks";
import {i18nLinks, postsCollection} from "../../../content";
import { getI18nPermalink } from "../../../utils/content";

export async function getStaticPaths() {
  return BLOG.locales.flatMap((locale) =>
    postsCollection.filter((post) => post.params.locale == locale)
  );
}

const { data, document, render } = Astro.props;
const { Content } = await render();
const meta = {
  title: `${data.title} â€” ${SITE.name}`,
  description: data.description,
  canonical:
    data.canonical ||
    getCanonical(getI18nPermalink(i18nLinks, Astro.params.locale)),
  image: data.image,
};
---

<Layout meta={meta} i18nLinks={i18nLinks} document={document}>
  <SinglePost data={data}>
    <Content />
  </SinglePost>
</Layout>
